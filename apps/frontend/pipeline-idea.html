<!DOCTYPE html>
<html lang="en">
<head>
  <meta charset="UTF-8"/>
  <meta name="viewport" content="width=device-width, initial-scale=1.0"/>
  <title>Pipeline Â· Idea</title>
  <link rel="preconnect" href="https://fonts.googleapis.com"/>
  <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin/>
  <link href="https://fonts.googleapis.com/css2?family=DM+Sans:wght@400;500;600;700&family=Space+Grotesk:wght@500;600;700&display=swap" rel="stylesheet"/>
  <link rel="stylesheet" href="/enterprise.css"/>
</head>
<body class="enterprise pipeline-board-page idea-studio-page" data-stage="idea">
  <header class="topbar">
    <div class="brand"><span class="brand-badge">Factory</span> Product Factory</div>
    <div class="topbar-right">
      <span id="crumb" class="user-pill">-</span>
      <span id="userEmail" class="user-pill">-</span>
      <a href="#" data-action="signout" class="signout-btn">Sign out</a>
    </div>
  </header>

  <main class="idea-studio-shell">
    <section class="idea-studio-top">
      <div>
        <p class="kicker">Pipeline</p>
        <h1>Pipeline - Idea</h1>
        <div id="scopePill" class="scope-pill">-</div>
      </div>
      <div class="idea-top-actions">
        <select aria-label="Mode">
          <option>Review mode</option>
          <option>Authoring mode</option>
        </select>
      </div>
    </section>

    <div id="alert" class="alert">Describe idea intent in chat, refine with AI, and submit PR for approval.</div>

    <section class="idea-studio-grid">
      <aside class="idea-stage-rail">
        <h2>Pipeline Stages</h2>
        <div class="stage-item active">
          <span class="n">1</span>
          <div>
            <div class="stage-title-row">
              <div class="t">Idea Builder</div>
              <span class="stage-status active">Draft</span>
            </div>
            <div class="s">Player One</div>
          </div>
        </div>
        <div class="stage-item">
          <span class="n">2</span>
          <div>
            <div class="stage-title-row">
              <div class="t">Spec</div>
              <span class="stage-status">Triage</span>
            </div>
            <div class="s">Player Two</div>
          </div>
        </div>
        <div class="stage-item">
          <span class="n">3</span>
          <div>
            <div class="stage-title-row">
              <div class="t">Build PR</div>
              <span class="stage-status">Triage</span>
            </div>
            <div class="s">Player One</div>
          </div>
        </div>
        <div class="stage-item">
          <span class="n">4</span>
          <div>
            <div class="stage-title-row">
              <div class="t">Review Gate</div>
              <span class="stage-status muted">None</span>
            </div>
            <div class="s">None</div>
          </div>
        </div>
        <div class="stage-item">
          <span class="n">5</span>
          <div>
            <div class="stage-title-row">
              <div class="t">Release</div>
              <span class="stage-status muted">None</span>
            </div>
            <div class="s">None Prime</div>
          </div>
        </div>
      </aside>

      <section class="idea-center-column">
        <article class="card idea-conversation-card">
          <div class="idea-conversation-head">
            <h2>Idea Conversation</h2>
            <div class="idea-filter-row">
              <span class="chip">All</span>
              <span class="chip">Triage</span>
              <span class="chip">Multimodal</span>
            </div>
          </div>
          <div id="ideaContextBadge" class="idea-context-badge">Context focus: loading current ideas...</div>
          <div id="enrichChatMessages" class="chat-log idea-chat-log studio-chat-log"></div>
        </article>

        <article class="card idea-draft-card">
          <div class="idea-draft-head">
            <h2>AI Draft</h2>
            <span id="ideaDraftSource" class="chip muted">No draft</span>
          </div>
          <div class="idea-summary-row">
            <p id="enrichSummaryLine" class="mini">No enrichment yet.</p>
            <button id="viewFullIdea" class="ghost" type="button" disabled>View Full Idea</button>
          </div>
          <div id="ideaDraftSummary" class="idea-draft-summary">
            <div class="idea-draft-summary-title">AI draft will appear here.</div>
            <p class="idea-draft-summary-text">Send a message to generate an enriched draft from product and idea context.</p>
          </div>
          <details id="ideaDraftDetails" class="idea-draft-details">
            <summary>View Full Draft</summary>
            <div id="ideaSuggestions" class="llm-feedback">AI enrichment output appears here as you chat.</div>
          </details>
        </article>

        <article class="card idea-composer-card">
          <div id="enrichChatImagePreview" class="chat-image-preview"></div>
          <textarea id="enrichChatInput" rows="3" placeholder="Describe the idea, constraints, outcomes, and attach images or diagrams..." aria-label="Idea enrichment input"></textarea>
          <div class="hint">
            <div id="aiProgressLabel">AI generation idle.</div>
            <div class="progress-shell"><div id="aiProgressBar" class="progress-bar"></div></div>
          </div>
          <div id="enrichLoadingSkeleton" class="loading-skeleton-stack" style="display:none;" aria-hidden="true">
            <div class="loading-skeleton line w-80"></div>
            <div class="loading-skeleton line w-100"></div>
            <div class="loading-skeleton line w-60"></div>
          </div>
          <div class="row">
            <label class="btn-link" for="enrichChatImages">Attach Images</label>
            <input id="enrichChatImages" type="file" accept="image/*" multiple style="display:none;" aria-label="Attach images for enrichment context" />
            <button id="enrichChatSend" type="button" aria-label="Send enrichment message">Send</button>
            <button id="createIdea" type="button" aria-label="Submit idea and create PR">Submit Idea</button>
          </div>
          <div id="enrichSuccessBanner" class="action-success" style="display:none;" role="status" aria-live="polite"></div>
          <div id="enrichErrorBanner" class="action-error" style="display:none;" role="alert" aria-live="assertive">
            <div id="enrichErrorText" class="text"></div>
            <div class="actions">
              <button id="enrichRetry" class="ghost" type="button">Retry</button>
              <button id="enrichViewLogs" class="ghost" type="button">View Logs</button>
            </div>
          </div>
        </article>

        <article class="card" id="fullIdeaRenditionCard" style="display:none;">
          <h2>Approved Idea</h2>
          <div id="fullIdeaRendition" class="llm-feedback"></div>
        </article>
      </section>

      <aside class="idea-right-column">
        <article class="decision-panel">
          <h2>Decision Panel</h2>
          <div class="decision-score-row">
            <span>Readiness Score</span>
            <strong id="decisionReadiness">--</strong>
          </div>
          <ul class="decision-metrics">
            <li><span>Completeness</span><strong id="decisionCompleteness">--</strong></li>
            <li><span>Risks</span><strong id="decisionRisks">--</strong></li>
            <li><span>Testability</span><strong id="decisionTestability">--</strong></li>
            <li><span>Scope</span><strong id="decisionScope">--</strong></li>
            <li><span>Dependencies</span><strong id="decisionDependencies">--</strong></li>
          </ul>
        </article>

        <article class="card right-card">
          <h2>Top Suggestion</h2>
          <p id="decisionTopSuggestion" class="suggestion-line">AI will suggest improvements after your first message.</p>
          <h2 style="margin-top:12px;">Primary Risk</h2>
          <p id="decisionPrimaryRisk" class="risk-line">No primary risk identified yet.</p>
        </article>

        <article class="card right-card">
          <h2>Current Ideas Context</h2>
          <p id="currentIdeasContextMeta" class="mini">Loading current ideas context...</p>
          <div id="currentIdeasContextList" class="current-ideas-context-list"></div>
          <h2 style="margin-top:12px;">Related Ideas</h2>
          <p id="relatedIdeasMeta" class="mini">Type in chat to retrieve similar ideas.</p>
          <div id="relatedIdeasLoading" class="loading-skeleton-stack" style="display:none;" aria-hidden="true">
            <div class="loading-skeleton line w-80"></div>
            <div class="loading-skeleton line w-70"></div>
          </div>
          <div id="relatedIdeasList" class="related-ideas-list"></div>
          <p id="relatedIdeasWarning" class="related-ideas-warning" style="display:none;"></p>
        </article>

        <article class="card right-card">
          <h2>PR Gate</h2>
          <div id="ideaPrStatus" class="data-item">
            <div class="t">PR gate pending</div>
            <div class="s">Submit idea to open PR for approval.</div>
          </div>
          <div id="prLoadingSkeleton" class="loading-skeleton-stack" style="display:none;" aria-hidden="true">
            <div class="loading-skeleton line w-70"></div>
            <div class="loading-skeleton line w-90"></div>
          </div>
          <div id="prSuccessBanner" class="action-success" style="display:none; margin-top:10px;" role="status" aria-live="polite"></div>
          <div id="prErrorBanner" class="action-error" style="display:none; margin-top:10px;" role="alert" aria-live="assertive">
            <div id="prErrorText" class="text"></div>
            <div class="actions">
              <button id="prReconnect" class="ghost" type="button">Reconnect GitHub</button>
              <button id="prRetry" class="ghost" type="button">Retry</button>
            </div>
          </div>
          <div class="row" style="margin-top:10px;">
            <button class="ghost" id="approveIdeaPr" disabled>Approve Idea PR</button>
            <button class="ghost" id="continueSpec" disabled>Continue to Spec</button>
          </div>
        </article>
      </aside>
    </section>

    <input id="ideaHeadline" type="hidden" />
    <textarea id="ideaDescription" style="display:none;"></textarea>
  </main>

  <dialog id="ideaPrDialog" class="pr-dialog">
    <div class="pr-dialog-content">
      <h3>PR Submitted</h3>
      <p>Your idea PR was created and is waiting for human approval.</p>
      <div id="ideaPrDialogMeta" class="mini"></div>
      <div class="row" style="margin-top:12px;">
        <a id="ideaPrDialogOpenPr" class="btn-link" href="#" target="_blank" rel="noreferrer" style="display:none;">Open PR</a>
        <button id="ideaPrDialogClose" class="ghost" type="button">Close</button>
      </div>
    </div>
  </dialog>

  <div id="ideaDrawerBackdrop" class="idea-drawer-backdrop" hidden></div>
  <aside id="ideaDrawer" class="idea-drawer" aria-hidden="true">
    <header class="idea-drawer-head">
      <div>
        <p class="kicker">Idea Artifact</p>
        <h2 id="ideaDrawerTitle">Full Idea</h2>
      </div>
      <button id="ideaDrawerClose" class="ghost" type="button" aria-label="Close full idea drawer">Close</button>
    </header>
    <nav class="idea-drawer-tabs" aria-label="Idea sections">
      <button type="button" data-tab="overview" class="active">Overview</button>
      <button type="button" data-tab="scope">Scope &amp; Non-Goals</button>
      <button type="button" data-tab="personas">Personas</button>
      <button type="button" data-tab="architecture">Architecture</button>
      <button type="button" data-tab="criteria">Acceptance Criteria</button>
      <button type="button" data-tab="audit">Audit Trail</button>
    </nav>
    <section id="ideaDrawerBody" class="idea-drawer-body"></section>
  </aside>

  <script src="/idea-state.js"></script>
  <script src="/idea-view-model.js"></script>
  <script src="/ui-components.js"></script>
  <script src="/pipeline-stage.js"></script>
</body>
</html>
